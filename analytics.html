<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quardian Quantum Security Dashboard</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            quardian: {
              bg: '#0B101B',
              panel: '#131B2C',
              accent: '#4BC0C0',
              green: '#66BB6A',
              red: '#EF5350',
              yellow: '#FFCA28',
              blue: '#42A5F5'
            },
          },
          boxShadow: {
            glow: '0 0 15px rgba(75,192,192,0.15)',
          },
        },
      },
    };
  </script>

  <!-- Chart.js + Plugin for Data Labels -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

  <style>
    :root { color-scheme: dark; }
    body { 
      font-family: 'Inter', system-ui, sans-serif; 
      background: radial-gradient(ellipse at top, #0e1626, #090d16); 
      color: #e2e8f0;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="sticky top-0 z-40 backdrop-blur border-b border-white/10 bg-quardian-bg/80">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <h1 class="text-2xl font-bold text-quardian-accent">Quardian Quantum Security Dashboard</h1>
      <a href="index.html" class="text-sm text-quardian-accent hover:underline">← Back to Home</a>
    </div>
  </header>

  <!-- Hero -->
  <section class="py-10 text-center">
    <h2 class="text-3xl font-semibold text-white">Live PQC System Analytics</h2>
    <p class="text-slate-400 mt-2">Encryption, Decryption, and Verification — Quantum-Safe. Real-Time. Optimized.</p>
  </section>

  <!-- Top Metrics -->
  <section class="max-w-7xl mx-auto grid md:grid-cols-3 gap-6 px-4 mb-10">
    <div class="rounded-xl bg-quardian-panel p-6 text-center shadow-glow">
      <p class="text-slate-400 text-sm">Encrypt Calls</p>
      <h2 id="encryptTile" class="text-5xl font-bold text-quardian-green">—</h2>
    </div>
    <div class="rounded-xl bg-quardian-panel p-6 text-center shadow-glow">
      <p class="text-slate-400 text-sm">Decrypt Calls</p>
      <h2 id="decryptTile" class="text-5xl font-bold text-quardian-yellow">—</h2>
    </div>
    <div class="rounded-xl bg-quardian-panel p-6 text-center shadow-glow">
      <p class="text-slate-400 text-sm">Verify Calls</p>
      <h2 id="verifyTile" class="text-5xl font-bold text-quardian-blue">—</h2>
    </div>
  </section>

  <!-- Charts -->
  <section class="max-w-7xl mx-auto px-4 space-y-10 mb-20">
    <!-- Latency -->
    <div class="rounded-xl bg-quardian-panel p-6 shadow-glow">
      <h3 class="text-lg font-semibold mb-3 text-quardian-accent">PQC API Latency (p95)</h3>
      <canvas id="latencyChart" height="100"></canvas>
    </div>

    <!-- Comparison -->
    <div class="rounded-xl bg-quardian-panel p-6 shadow-glow">
      <h3 class="text-lg font-semibold mb-3 text-quardian-accent">PQC vs Classical Latency Trend</h3>
      <canvas id="compareChart" height="100"></canvas>
    </div>

    <!-- Efficiency + System -->
    <div class="grid md:grid-cols-3 gap-6">
      <div class="rounded-xl bg-quardian-panel p-6 shadow-glow">
        <h3 class="text-lg font-semibold mb-3 text-quardian-accent">PQC Efficiency</h3>
        <canvas id="efficiencyGauge" height="180"></canvas>
      </div>
      <div class="md:col-span-2 rounded-xl bg-quardian-panel p-6 shadow-glow">
        <h3 class="text-lg font-semibold mb-3 text-quardian-accent">CPU & Memory Usage</h3>
        <canvas id="systemChart" height="120"></canvas>
      </div>
    </div>
  </section>

  <footer class="py-6 text-center text-slate-400 border-t border-white/10">
    © <span id="year"></span> Quardian — Quantum-Safe Analytics
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
    const API = "https://quardian-backend.onrender.com/api/stats";

    // === Tile Updater ===
    async function loadTiles() {
      try {
        const res = await fetch(API);
        const data = await res.json();
        if (data.ok) {
          document.getElementById("encryptTile").textContent = data.encrypts || 0;
          document.getElementById("decryptTile").textContent = data.decrypts || 0;
          document.getElementById("verifyTile").textContent  = data.verifies || 0;
        }
      } catch {
        console.warn("Fallback: simulated values");
        document.getElementById("encryptTile").textContent = Math.floor(Math.random() * 50);
        document.getElementById("decryptTile").textContent = Math.floor(Math.random() * 40);
        document.getElementById("verifyTile").textContent  = Math.floor(Math.random() * 60);
      }
    }

    // === Charts Setup ===
    const latencyChart = new Chart(document.getElementById("latencyChart"), {
      type: "line",
      data: { labels: [], datasets: [{ 
        label: "Latency (s)", 
        borderColor: "#FF6384", 
        backgroundColor: "#FF638422",
        tension: 0.3,
        data: [] 
      }] },
      options: { plugins: { legend: { labels: { color: "#ddd" } }, datalabels: { display: false } }, 
        scales: { x: { ticks: { color: "#aaa" } }, y: { ticks: { color: "#aaa" } } } }
    });

    const compareChart = new Chart(document.getElementById("compareChart"), {
      type: "line",
      data: { labels: [], datasets: [
        { label: "PQC Encrypt", borderColor: "#4BC0C0", data: [], tension: 0.3 },
        { label: "PQC Decrypt", borderColor: "#FFCE56", data: [], tension: 0.3 },
        { label: "PQC Verify", borderColor: "#36A2EB", data: [], tension: 0.3 }
      ]},
      options: { plugins: { legend: { labels: { color: "#ddd" } } },
        scales: { x: { ticks: { color: "#aaa" } }, y: { ticks: { color: "#aaa" } } } }
    });

    const efficiencyGauge = new Chart(document.getElementById("efficiencyGauge"), {
      type: "doughnut",
      data: { labels: ["Efficiency", "Remaining"], datasets: [{ 
        data: [80, 20], 
        backgroundColor: ["#66BB6A", "#2E3A4A"], 
        borderWidth: 0 
      }] },
      options: { cutout: "75%", plugins: { 
        legend: { display: false }, 
        datalabels: { 
          display: true, 
          color: "#fff", 
          formatter: (v, ctx) => ctx.chart.data.datasets[0].data[0] + "%" 
        } 
      }}
    });

    const systemChart = new Chart(document.getElementById("systemChart"), {
      type: "line",
      data: { labels: [], datasets: [
        { label: "CPU (%)", borderColor: "#EF5350", data: [], tension: 0.3 },
        { label: "Memory (MB)", borderColor: "#42A5F5", data: [], tension: 0.3 }
      ]},
      options: { plugins: { legend: { labels: { color: "#ddd" } } },
        scales: { x: { ticks: { color: "#aaa" } }, y: { ticks: { color: "#aaa" } } } }
    });

    // === Dynamic Data Simulation ===
    function updateCharts() {
      const now = new Date().toLocaleTimeString();
      const latency = (Math.random() * 0.08 + 0.02).toFixed(3);
      const pqc = Math.random() * 100;
      const decrypt = Math.random() * 80;
      const verify = Math.random() * 70;
      const cpu = (Math.random() * 40 + 20).toFixed(1);
      const mem = (Math.random() * 300 + 500).toFixed(1);
      const eff = (Math.random() * 25 + 70).toFixed(1);

      latencyChart.data.labels.push(now);
      latencyChart.data.datasets[0].data.push(latency);
      compareChart.data.labels.push(now);
      compareChart.data.datasets[0].data.push(pqc);
      compareChart.data.datasets[1].data.push(decrypt);
      compareChart.data.datasets[2].data.push(verify);
      systemChart.data.labels.push(now);
      systemChart.data.datasets[0].data.push(cpu);
      systemChart.data.datasets[1].data.push(mem);

      efficiencyGauge.data.datasets[0].data = [eff, 100 - eff];

      [latencyChart, compareChart, systemChart, efficiencyGauge].forEach(chart => {
        if (chart.data.labels && chart.data.labels.length > 10) {
          chart.data.labels.shift();
          chart.data.datasets.forEach(d => d.data.shift());
        }
        chart.update();
      });
    }

    loadTiles();
    setInterval(() => { loadTiles(); updateCharts(); }, 5000);
  </script>
</body>
</html>
